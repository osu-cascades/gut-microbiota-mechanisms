<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gut Microbiota Mechanisms</title>
  <link href="styles/stylesheet.css" rel="stylesheet" type="text/css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/4.4.1/math.js"></script>
</head>

<body>
	<h1>Gut Microbiota Mechanisms</h1>

	<div class="sliders_wrap">
    <h2>Data Set:</h2>
		<h3>Number of Functions: 6</h3>
		<input type="range" class="slider" id="numberOfFunctionsSlider">
		<h3>Minimum Species Needed: 1</h3>
		<input type="range" class="slider">
		<h3>Donor Depletion: 0.25</h3>
		<input type="range" class="slider">
    <h2>Data Point:</h2>
    <h3>Probability of Establishment: 0.6</h3>
		<input type="range" class="slider">
		<h3>Species/Function (Intact): 8</h3>
		<input type="range" class="slider">
	</div>

	<div id="graph" class="graph"></div>

	<script type="text/javascript">
  var data = new vis.DataSet();
  var counter = 0;

  var xAxisStep = 0.2;
  var xAxisMax = 0.9;

  var yAxisStep = 4;
  var yAxisMax = 64;

  var d = 0.25;
  var m = 6;
  var z = 1;

  for (var x = 0.1; x <= xAxisMax; x += xAxisStep) {
    yAxisStep = 4;
    for (var y = 8; y <= yAxisMax; y += yAxisStep) {
      yAxisStep *= 2;

      var yd = (1 - d) * y;
      var q = 1 - x;

      var probabilityDepleted = (math.factorial(yd) / (math.factorial(m) * math.factorial(yd - m))) * (Math.pow(x,m) * Math.pow(q,(yd - m)));
      var probabilityIntact = (math.factorial(y) / (math.factorial(m) * math.factorial(y - m))) * (Math.pow(x,m) * Math.pow(q,(y - m)));
      var value = Math.pow(probabilityDepleted,z) / Math.pow(probabilityIntact,z);

      if (value > 1) {
        value = 1;
      }

      console.log("x = " + x + "\ny = " + y + "\nvalue = " + value);
      data.add({id:counter++,x:x,y:y,z:value,style:value});
    }
  }

	  var options = {
	    width:  '100%',
	    height: '100%',
	    style: 'surface',
	    showPerspective: true,
	    showGrid: true,
	    showShadow: false,
	    keepAspectRatio: false,
      yStep: 8
	  };

	  var container = document.getElementById('graph');
	  var graph3d = new vis.Graph3d(container, data, options);
	</script>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('numberOfFunctionsSlider').onchange = changeEventHandler;
		}, false);

		function changeEventHandler(event) {
		  console.log("Update the graph!");
		}
	</script>
</body>
</html>
